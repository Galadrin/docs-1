# Beta Network

The beta network contains the most recent developed features and is expected to have errors.
Basic knowledge about cosmos-sdk and linux servers is highly recommended.

### Major Change: Interpool security

The biggest difference to the current korellia network is the feature of interpool-security.
From now on, there is only one staker entry per address. And a staker can join multiple pools. Joining multiple pools means more rewards, but this comes also with the danger of being more vulnerable to slashes.

![interpool security](https://cdn.discordapp.com/attachments/889827445132374036/1016716774122733628/interpool_security.png)

### Explorer and Website

- [explorer.beta.kyve.network](https://explorer.beta.kyve.network/kyve-betanet/staking)
- [kyve-beta.netlify.app/#/](https://kyve-beta.netlify.app/#/)

For $KYVE ask in the Discord-Beta testers channels.

### Setting up a chain node

The process of setting up a beta node is similar to the general guide
[here](/validators/chain-node.md). However, less disk space is required, as
the network does not have that many transactions and is resettet here and then.

#### Obtaining binaries

```bash
wget https://nc2.breithecker.de/s/BY4Lzj8TAQzgJZm/download/chain_linux_amd64.tar.gz
tar -xvzf chain_linux_amd64.tar.gz

# The [moniker] is a human-readable name for your node
./chaind init [moniker] --chain-id kyve-beta
```

Other architectures:

- linux/arm64: [https://kyve-beta.s3.eu-central-1.amazonaws.com/genesis/chain_linux_arm64.tar.gz](https://kyve-beta.s3.eu-central-1.amazonaws.com/genesis/chain_linux_arm64.tar.gz)
- darwin/amd64: [https://kyve-beta.s3.eu-central-1.amazonaws.com/genesis/chain_darwin_amd64.tar.gz](https://kyve-beta.s3.eu-central-1.amazonaws.com/genesis/chain_darwin_amd64.tar.gz)

Obtain the genesis:

```bash
wget https://kyve-beta.s3.eu-central-1.amazonaws.com/genesis/genesis-v0.7.0-beta.json
# move to the chain-node directory
mv genesis-v0.7.0-beta.json ~/.kyve/config/genesis.json
```

Start the chain

```bash
./chaind start --p2p.persistent_peers="410bf0cb2cdb9a6e159c14b9d01531b9ecb1edd4@3.70.26.46:26656"
```

#### Cosmovisor, Systemd and Validators

The setup of cosmovisor and systemd is the same as described [here](/validators/chain-node.md#setup-cosmovisor)
and [here](/validators/chain-node.md#setting-up-deamon-service).

For [Becoming a validator](../validators/chain-node.md#becoming-a-validator) keep in mind to use the correct chain-id `kyve-beta`.

### Setting up protocol nodes

#### 1. Create the validator

In order to create your validator visit the beta KYVE app [kyve-beta.netlify.app/#/validators](https://kyve-beta.netlify.app/#/validators) and click on `Become a validator`.

There you can choose your preferred `self delegation` which is the same as `stake` before. The self delegation determines the probability of creating bundles and therefore earning rewards. If the validator misbehaves the self delegation will get partially slashed.
Others can also delegate to you. This will improve your probability of earning more rewards. To attract them, you can change your commission under `Manage Commission` on your validator page. If the validator misbehaves those delegators will get slashed, too.

After the validator got created you can view your validator in detail by clicking on it. If you want to change your moniker, website and even your logo you can do that by clicking on `Manage Validator` and then on `Manage Metadata`

#### 2. Run protocol nodes with KYSOR (recommended)

**Running nodes with KYSOR has the following benefits:**

- Only use **one** program to run on **every** pool
- Not installing and compiling protocol binaries **manually** for every pool
- Getting the new upgrade binaries during a pool upgrade **automatically** and therefore **don't risk timeout slashes**
- Make running protocol nodes **standardized** and **easier**

**Installation**

Currently, there are no binaries for the KYSOR, therefore it has to be installed and build manually by cloning the repository:

```bash
git clone https://github.com/kyve-org/kysor.git

cd kysor

git checkout beta
```

::: warning
**IMPORTANT**: Make sure to check out the `beta` branch of KYSOR.
:::

**Install dependencies**

In order to get started run the following in the project root directory:

```bash
yarn install
```

**Setup**

General directory structure and important files:

- `src` contains all the source code of KYSOR
- `kysor.conf.ts` is the main config file. It is explained in more detail below
- `secrets` is the directory where your secrets are stored like `valaccount` and `wallet`
- `runtimes` will be autogenerated once you start KYSOR and will contain all binaries structured by runtime and version
- `db` will be autogenerated once you start KYSOR and will contain all caching data for the protocol nodes
- `logs` will be autogenerated once you start KYSOR and will contain all log data for the protocol nodes

In order to setup KYSOR the following secrets need to be **created** under the `secrets` directory:

- `valaccount` this is the file which contains your mnemonic of your valaccount. This mnemonic will be used to run the node with.
- `wallet` this is the arweave keyfile you need to provide in order to run protocol nodes. This file will be used to run the node with.

::: warning
**IMPORTANT**: Make sure that the files `valaccount` and `wallet` have no file extensions.
:::

The final directory structure should look like this:

```
kysor/
  node_modules/
    ...
  src/
    index.ts
    ...
  secrets/
    valaccount
    wallet
  kysor.conf.ts
  package.json
  ...

```

**Run KYSOR**

After adding the required secrets you can check the `kysor.conf.ts` file. When you initially open it, it should look like this:

```ts
import { IConfig } from './src/faces';

const config: IConfig = {
  // target of the host machine, can be either "linux-x64", "linux-arm64" or "macos-x64"
  // important for downloading the correct binaries
  hostTarget: 'linux-x64',

  // whether KYSOR should auto download new binaries
  // if set to false, you have to insert the binaries manually
  autoDownload: true,

  // whether KYSOR should verify the checksums of downloaded binaries
  // if autoDownload is false this option can be ignored
  verifyChecksums: true,

  // settings for protocol node
  // notice that mnemonic and keyfile is missing, those need to be files under the secrets directory
  protocolNode: {
    // the ID of the pool you want to join as a validator
    // an overview of all pools can be found here -> https://app.kyve.network
    pool: 0,

    // the network you want to run on
    // currently only the testnet network "beta" is available
    network: 'beta',

    // specify verbose logging
    // is often recommended in order to have a more detailed insight
    verbose: true,

    // specify if local prometheus metrics server should run
    // metric server will start on http:localhost:8080/metrics
    metrics: true,
  },
};

export default config;
```

Since this file is commented and explained in detail the info regarding config properties can be found in this file.

After entering your config like the `pool` and other settings that are required to run a protocol node on a pool you can start KYSOR by running

```
yarn start
```

When you see logs like this everything should work fine

```ts
2022-09-21 08:13:46.333  INFO  Stopped child process ...
2022-09-21 08:13:46.347  INFO  Attempting to fetch pool state.
Found Runtime version = 1.8.3 required = 1.8.4
2022-09-21 08:13:46.440  INFO  Fetched pool state
2022-09-21 08:13:46.441  INFO  Binary of runtime "@kyve/evm" with version 1.8.4 not found locally
2022-09-21 08:13:46.441  INFO  Found downloadable binary on pool
2022-09-21 08:13:46.442  INFO  Downloading https://github.com/KYVENetwork/node/releases/download/%40kyve%2Fevm%401.8.4/kyve-macos-x64.zip?checksum=491d256bbdec35fa712a2a7bc79f18e931231a468cf7bb251b957c8c29f9c70f ...
2022-09-21 08:13:49.634  INFO  Extracting binary to "./runtimes/@kyve/evm/1.8.4/kyve.zip" ...
2022-09-21 08:13:50.284  INFO  Deleting kyve.zip ...
2022-09-21 08:13:50.428  INFO  Comparing binary checksums ...

2022-09-21 08:13:50.428  INFO  Found checksum = 491d256bbdec35fa712a2a7bc79f18e931231a468cf7bb251b957c8c29f9c70f
2022-09-21 08:13:50.429  INFO  Local checksum = 491d256bbdec35fa712a2a7bc79f18e931231a468cf7bb251b957c8c29f9c70f

2022-09-21 08:13:50.429  INFO  Checksums are equal. Continuing ...
2022-09-21 08:13:50.429  INFO  Starting child process ...
```

#### Get the protocol node binaries by compiling it yourself (only if not running KYSOR)

After successfully creating the validator the protocol node binaries have the be build and prepared. The current developement repository is avaiable here [github.com/KYVENetwork/node](https://github.com/KYVENetwork/node). For the beta network only pools
with the evm runtime will be available, so this tutorial will only focus on building the evm binaries.

To build the evm binaries execute the following commands:

```bash
git clone git@github.com:KYVENetwork/node.git
cd node

yarn install
yarn setup

cd integrations/evm
yarn build:binaries
```

After that the binaries should be available under the following path: `/integrations/evm/*`

#### 3. Add the arweave.json keyfile to the file backend

It is also required to have an Arweave keyfile in order to save data on Arweave. The keyfile needs to be added to the file backend. This can also be done with the binary CLI in the following way:

```bash
./kyve-linux wallets add "my_first_wallet" "$(cat /path/to/arweave.json)"
```

The command saves the content of your `arweave.json` keyfile into the encrypted file backend. More information about the wallet CLI can be found with `./kyve-macos wallets -h`

::: warning
**INFORMATION**: If you want to store your keyfiles encrypted just add to **every** command the following option `--use-password`. Then you are prompted to choose a custom password.
:::

#### 4. Create a valaccount

With the new Interpool-Security feature a single validator can join multiple pools. For every pool a validator wants to join he needs a `Valaccount`. A valaccount just consists of a seperate KYVE address, which is just used to run one protocol node on one pool with the authorization of the main validator account. A valaccount address, or in short a `Valaddress` can be created with the help of the binary CLI in the following way:

```bash
./kyve-linux valaccounts create "my-first-valaccount"
```

This command generates a compeletey new and random valaddress for you and saves in an encrypted file backend. More information on the valaccount CLI can be found with `./kyve-macos valaccounts -h`

::: warning
**INFORMATION**: If you want to store your keyfiles encrypted just add to **every** command the following option `--use-password`. Then you are prompted to choose a custom password.
:::

#### 5. Start the binary on the pool you want to join

In our example we want to join the Moonbeam Pool. For that you only need to know the Pool Id which can be found by clicking on a pool. In our case the Pool Id of Moonbeam is `0`. We also want to check if the self delegation is higher than the minimum self delegation of the pool in order to join. This is important, because pools still have limited slots (50).

If the following information is clear the protocol binary can be started with the following command:

```bash
./kyve-linux start --pool 0 --account my-first-valaccount --wallet my_first_wallet --network beta --verbose
```

This will start the node and should produce the following logs:

```bash
2022-09-06 13:53:09.136  INFO  Valaccount my-first-valaccount has not joined the pool with id 0 yet
2022-09-06 13:53:09.138  INFO  Visit https://app.kyve.network/#/pools/0 and add join the pool with the following information:

2022-09-06 13:53:09.139  INFO  Valaddress:    kyve1qkqjus0hg0qnhz97jzmljx8aaghj0zkne2d24q
2022-09-06 13:53:09.140  INFO  Valname:       considerable-red-guineafowl

2022-09-06 13:53:09.140  INFO  The node will not continue until the account is authorized
```

It will pause on the first startup because as the last step it needs to be authorized from the main validator account to run for it.

#### 6. Finally join a pool with a valaccount

Now that the node is already running it just needs the authorization from it's main validator account in order to run for this validator and generate rewards. For that visit your validator page and click on `Join existing pool`.

A dialog should open where you should select the pool you want to join (here Moonbeam). After that enter the Valaddress that needs to be authorized and the Valname, which just serves as a security that the node has actually been started. (If you join a pool without having the node running you are in danger of receiving a timeout slash because once you join a pool you are expected to validate and upload data).

For the last option you can do a one time transfer so that the valaccount has some $KYVE to pay for transaction fees. We would recommend sending 1000 $KYVE for the start. Make sure that the valaccount always has enough $KYVE to pay for the fees, otherwise you are again in danger of receiving a timeout slash.

Once you have joined the pool the node should continue in about ~10 seconds. After that you are successfully participating in a pool.

#### 7. Join other pools if you want to increase your rewards

This step is optional, but the more pools you participate in the higher the rewards. If you want to join another pool just repeat the steps from point 4. You can see all the pools you are participating in in your validator page.

::: warning
**WARNING**: But beware, joining for example a second pool might double your rewards, but it would also double the danger of getting slashed.
:::
